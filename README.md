# api-kora-live.im

**API لاستخراج بيانات المباريات وروابط البث من موقع kora-live.im**

هذا المشروع عبارة عن واجهة برمجة تطبيقات (API) مبنية باستخدام **FastAPI** و **Python**، مصممة لاستخراج بيانات المباريات في الوقت الفعلي من موقع [kora-live.im](https://www.kora-live.im/).

## الميزات

*   **تحديث البيانات في الوقت الفعلي:** يتم إرسال طلبات سحب البيانات (Scraping) إلى الموقع كل **800 مللي ثانية** للحصول على أحدث النتائج.
*   **استخراج بيانات المباريات:** يستخرج أسماء الفرق، الشعارات، البطولة، الوقت، وحالة المباراة.
*   **ربط البث (m3u8):** يتضمن منطقًا لمحاولة استخراج رابط البث المباشر (m3u8) من صفحة المباراة.
*   **آلية Keep-Alive:** يتضمن منطقًا لإرسال طلبات ذاتية دورية (Self-Ping) للحفاظ على الخدمة نشطة على منصات الاستضافة المجانية مثل Render.

## نقطة النهاية (Endpoint)

يمكن الوصول إلى بيانات المباريات المحدثة عبر نقطة النهاية التالية:

`GET /matches/api`

**مثال على الاستجابة:**

```json
[
  {
    "id": "1",
    "n1": "ليفربول",
    ""n2": "برينتفورد",
    "imag1": "https://www.kooralive.space/path/to/liverpool-logo.png",
    "imag2": "https://www.kooralive.space/path/to/brentford-logo.png",
    "ma": "PM",
    "anat": "beIN SPORTS HD 1",
    "daw": "إنجلترا، الدوري الإنجليزي",
    "time": "20:30",
    "rt": "جاري",
    "m3u8": "" 
  }
]
```

## النشر على Render

لإطلاق هذا المشروع على Render، اتبع الخطوات التالية:

1.  **إنشاء خدمة ويب جديدة (Web Service):**
    *   قم بالدخول إلى لوحة تحكم Render.
    *   اختر "New" ثم "Web Service".
2.  **ربط المستودع:**
    *   اختر المستودع `api-kora-live.im` من GitHub.
3.  **إعدادات الخدمة:**
    *   **Name:** اختر اسمًا لخدمتك (مثلاً: `kora-live-scraper`).
    *   **Region:** اختر المنطقة الأقرب إليك.
    *   **Branch:** `main`.
    *   **Root Directory:** اتركها فارغة.
    *   **Runtime:** `Python 3`.
    *   **Build Command:** `pip install -r requirements.txt`.
    *   **Start Command:** `uvicorn app:app --host 0.0.0.0 --port $PORT`. (هذا الأمر موجود في ملف `Procfile` أيضًا).
    *   **Instance Type:** اختر الخطة المجانية (Free).
4.  **النشر:**
    *   انقر على "Create Web Service". سيبدأ Render في بناء ونشر التطبيق.

**ملاحظة هامة حول الاستخراج:**

**تنبيه:** لقد واجهنا صعوبة في تحديد الـ **CSS Selectors** الصحيحة لاستخراج البيانات من موقع kora-live.im بسبب القيود على فحص شفرة المصدر بشكل كامل في بيئة التطوير.

*   **إذا لم يتم استخراج البيانات بعد النشر،** ستحتاج إلى تعديل دالة `extract_match_data` في ملف `app.py` لتستخدم الـ CSS selectors الصحيحة التي يمكنك استخراجها يدويًا من شفرة مصدر صفحة [kora-live.im](https://www.kora-live.im/) باستخدام أدوات المطور في متصفحك.
*   **المنطق جاهز، لكن الـ selectors تحتاج إلى تصحيح.**

## آلية Keep-Alive

لضمان عدم دخول الخدمة في وضع السكون (Sleep Mode) على الخطة المجانية لـ Render، يقوم التطبيق بإرسال طلب HTTP ذاتي إلى نقطة النهاية `/matches/api` كل 10 دقائق.

**لجعل هذه الآلية تعمل بشكل صحيح على Render،** يجب أن يتمكن التطبيق من معرفة عنوان URL العام الخاص به. يتم ذلك عادةً عبر متغير بيئة يوفره Render تلقائيًا (مثل `RENDER_EXTERNAL_URL`).

**لتفعيل الـ Keep-Alive:**

1.  في لوحة تحكم Render، انتقل إلى **Environment** لخدمتك.
2.  أضف متغير بيئة جديد باسم `RENDER_EXTERNAL_URL` وقيمته هي عنوان URL العام لخدمتك (مثلاً: `https://kora-live-scraper.onrender.com`).
3.  قم بإعادة نشر الخدمة.

**ملاحظة:** في الكود الحالي (ملف `app.py`)، تم وضع تعليق على منطق الـ Self-Ping لأنه لا يمكننا معرفة عنوان URL الخاص بـ Render محليًا. يجب تفعيل هذا المنطق في Render عبر إضافة متغير البيئة المذكور أعلاه.

## تشغيل محلي

1.  **استنساخ المستودع:**
    ```bash
    git clone https://github.com/bilal4487/api-kora-live.im.git
    cd api-kora-live.im
    ```
2.  **إنشاء بيئة افتراضية وتثبيت المتطلبات:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    ```
3.  **تشغيل الخادم:**
    ```bash
    uvicorn app:app --reload
    ```
    سيتم تشغيل الخادم على `http://127.0.0.1:8000`.

---
تم إنشاء هذا المشروع بواسطة Manus.
